<!doctype html><html lang="pt"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Clientes – Easycheck</title>
<link rel="stylesheet" href="./style.css"/>
</head><body>
<header><a class="card" href="index.html">← Voltar</a></header>
<main>
  <h2>Clientes</h2>
  <form id="cform">
    <label>Nome</label><input required name="name" placeholder="Cliente Teste"/>
    <label>Email</label><input name="email" placeholder="cliente@exemplo.com"/>
    <label>VAT</label><input name="vat" placeholder="LU12345678"/>
    <label>Endereço</label><input name="address" placeholder="Rua X, 123"/>
    <div class="row">
      <div style="flex:1"><label>País</label><input name="country" value="LU"/></div>
      <div style="flex:1"><label>Idioma</label><input name="locale" value="pt"/></div>
    </div>
    <div class="row">
      <div style="flex:1"><label>Dias de rapel</label><input name="dunning_days" type="number" value="15"/></div>
      <div style="flex:1"><label>Rapel automático</label>
        <select name="auto_dunning"><option value="false">Não</option><option value="true">Sim</option></select>
      </div>
    </div>
    <button>Guardar cliente</button>
  </form>

  <h3>Lista</h3>
  <div id="list"></div>
</main>

<script>
const API='https://api.easycheckglobal.com/api';
const COMPANY='22871176-0909-4ba5-a642-5db70db2e35f';
async function jget(p){return (await fetch(API+p)).json()}
async function jpost(p,b){return (await fetch(API+p,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(b)})).json()}
function $(s,r=document){return r.querySelector(s)}
function el(t,p={},c=[]){const e=document.createElement(t);Object.assign(e,p);(c||[]).forEach(x=>e.append(x));return e}
function tableFrom(items, cols){const t=el('table'),th=el('thead'),tr=el('tr');cols.forEach(c=>tr.append(el('th',{textContent:c.label})));th.append(tr);t.append(th);const tb=el('tbody');(items||[]).forEach(row=>{const tr=el('tr');cols.forEach(c=>{const td=el('td');td.textContent=typeof c.render=='function'?c.render(row):(row[c.key]??'');tr.append(td)});tb.append(tr)});t.append(tb);return t}

async function load(){
  const out=await jget(`/clients/list?company_id=${COMPANY}`);
  if(!out.ok) return $('#list').textContent=out.error||'erro';
  const cols=[{key:'name',label:'Nome'},{key:'email',label:'Email'},{key:'vat',label:'VAT'},{key:'dunning_days',label:'Rapel (dias)'},{key:'auto_dunning',label:'Auto?'}];
  $('#list').innerHTML=''; $('#list').append(tableFrom(out.clients,cols));
}
$('#cform').addEventListener('submit', async e=>{
  e.preventDefault();
  const fd=new FormData(e.target);
  const out=await jpost('/clients/create',{
    company_id:COMPANY,name:fd.get('name'),email:fd.get('email'),vat:fd.get('vat'),address:fd.get('address'),
    country:fd.get('country')||'LU',locale:fd.get('locale')||'pt',
    dunning_days:Number(fd.get('dunning_days')||15),auto_dunning:fd.get('auto_dunning')==='true'
  });
  if(!out.ok) return alert(out.error||'erro'); alert('Cliente criado!'); e.target.reset(); load();
});
load();
</script>
</body></html>
